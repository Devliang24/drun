config:
  name: 商品浏览与搜索测试
  base_url: ${ENV(BASE_URL)}
  tags: [products, smoke, regression]

steps:
  - name: 获取所有分类
    request:
      method: GET
      path: /api/v1/categories/
    extract:
      categories: $.data
      first_category_id: $.data[0].id
      first_category_name: $.data[0].name
    validate:
      - eq: [status_code, 200]
      - eq: [$.success, true]
      - gt: [$.data, []]
      - ne: ["$.data[0].id", null]
      - ne: ["$.data[0].name", null]

  - name: 获取指定分类详情
    request:
      method: GET
      path: /api/v1/categories/$first_category_id
    validate:
      - eq: [status_code, 200]
      - eq: [$.success, true]
      - eq: [$.data.id, $first_category_id]
      - eq: [$.data.name, $first_category_name]

  - name: 获取所有商品（默认分页）
    request:
      method: POST
      path: /api/v1/products/quick-search
      headers:
        Content-Type: application/json
      body:
        q: "*"
        limit: 20
    extract:
      products: $.data.items
      total_count: $.data.total
    validate:
      - eq: [status_code, 200]
      - eq: [$.success, true]
      - ge: [$.data.total, 0]

  - name: 按分类查询商品
    request:
      method: POST
      path: /api/v1/products/search
      headers:
        Content-Type: application/json
      body:
        category_id: $first_category_id
        limit: 10
    validate:
      - eq: [status_code, 200]
      - eq: [$.success, true]

  - name: 商品价格范围过滤
    request:
      method: POST
      path: /api/v1/products/search
      headers:
        Content-Type: application/json
      body:
        min_price: 10
        max_price: 100
        limit: 20
    validate:
      - eq: [status_code, 200]
      - eq: [$.success, true]

  - name: 查询有库存的商品
    request:
      method: POST
      path: /api/v1/products/search
      headers:
        Content-Type: application/json
      body:
        in_stock: true
        limit: 20
    validate:
      - eq: [status_code, 200]
      - eq: [$.success, true]

  - name: 商品搜索功能
    request:
      method: POST
      path: /api/v1/products/search
      headers:
        Content-Type: application/json
      body:
        search: "test"
        limit: 5
    validate:
      - eq: [status_code, 200]
      - eq: [$.success, true]

  - name: 商品排序测试（按价格升序）
    request:
      method: POST
      path: /api/v1/products/search
      headers:
        Content-Type: application/json
      body:
        sort_by: price
        sort_order: asc
        limit: 5
    validate:
      - eq: [status_code, 200]
      - eq: [$.success, true]

  - name: 商品排序测试（按创建时间降序）
    request:
      method: POST
      path: /api/v1/products/search
      headers:
        Content-Type: application/json
      body:
        sort_by: created_at
        sort_order: desc
        limit: 5
    validate:
      - eq: [status_code, 200]
      - eq: [$.success, true]
