# Drun Report Server ä½¿ç”¨æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°

Drun Report Server æ˜¯ä¸€ä¸ªåŸºäº FastAPI + SQLite çš„è½»é‡çº§æµ‹è¯•æŠ¥å‘ŠæœåŠ¡å™¨ï¼Œæä¾›ï¼š

- âœ… SQLite æŒä¹…åŒ–æŠ¥å‘Šå…ƒæ•°æ®
- âœ… è‡ªåŠ¨æ‰«æ `reports/` ç›®å½•å¹¶ç´¢å¼•
- âœ… æœç´¢å’Œç­›é€‰ï¼ˆç³»ç»Ÿåç§°ã€ç¯å¢ƒã€çŠ¶æ€ï¼‰
- âœ… ç»Ÿè®¡æ¦‚è§ˆï¼ˆæ€»æ•°ã€é€šè¿‡ç‡ã€å¹³å‡æ—¶é•¿ï¼‰
- âœ… REST APIï¼ˆå¯ä¾›å¤–éƒ¨ç³»ç»Ÿé›†æˆï¼‰
- âœ… è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£
- âœ… çƒ­é‡è½½å¼€å‘æ¨¡å¼

## å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æœåŠ¡å™¨

```bash
# åŸºæœ¬å¯åŠ¨ï¼ˆé»˜è®¤ç«¯å£ 8080ï¼Œè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼‰
drun serve

# è‡ªå®šä¹‰ç«¯å£
drun serve --port 9000

# å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰
drun serve --reload

# ç¦ç”¨è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
drun serve --no-open

# å›¢é˜Ÿå…±äº«ï¼ˆå…è®¸å¤–éƒ¨è®¿é—®ï¼Œè°¨æ…ä½¿ç”¨ï¼‰
drun serve --host 0.0.0.0 --port 8080

# æŒ‡å®šæŠ¥å‘Šç›®å½•
drun serve --reports-dir /path/to/reports
```

### 2. è®¿é—®åœ°å€

å¯åŠ¨åå¯ä»¥è®¿é—®ï¼š

- **å‰ç«¯é¡µé¢**: http://localhost:8080
- **API æ–‡æ¡£**: http://localhost:8080/docsï¼ˆFastAPI è‡ªåŠ¨ç”Ÿæˆï¼‰
- **å•ä¸ªæŠ¥å‘Š**: http://localhost:8080/reports/report-xxx.html

## å‘½ä»¤è¡Œé€‰é¡¹

```
Usage: drun serve [OPTIONS]

Options:
  --port INTEGER          ç›‘å¬ç«¯å£ [default: 8080]
  --host TEXT             ç›‘å¬åœ°å€ (0.0.0.0 å…è®¸å¤–éƒ¨è®¿é—®) [default: 127.0.0.1]
  --reports-dir TEXT      æŠ¥å‘Šç›®å½•è·¯å¾„ [default: reports]
  --reload / --no-reload  å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰ [default: no-reload]
  --open / --no-open      è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ [default: open]
  --help                  æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
```

## åŠŸèƒ½è¯´æ˜

### ç»Ÿè®¡å¡ç‰‡

é¦–é¡µé¡¶éƒ¨æ˜¾ç¤º 4 ä¸ªç»Ÿè®¡å¡ç‰‡ï¼š
- ğŸ“ Total Reports: æŠ¥å‘Šæ€»æ•°
- âœ… Total Passed: é€šè¿‡ç”¨ä¾‹æ€»æ•°
- âŒ Total Failed: å¤±è´¥ç”¨ä¾‹æ€»æ•°
- â± Avg Duration: å¹³å‡æ‰§è¡Œæ—¶é•¿

### ç­›é€‰åŠŸèƒ½

æ”¯æŒå¤šç§ç­›é€‰æ¡ä»¶ï¼š
- **ç³»ç»Ÿåç§°æœç´¢**: æ”¯æŒæ¨¡ç³ŠåŒ¹é…
- **çŠ¶æ€ç­›é€‰**: å…¨éƒ¨ / æˆåŠŸ / å¤±è´¥
- **ç¯å¢ƒç­›é€‰**: dev / staging / prod

### é‡æ–°æ‰«æ

ç‚¹å‡» "ğŸ”„ Rescan" æŒ‰é’®å¯ä»¥é‡æ–°æ‰«æ `reports/` ç›®å½•ï¼Œç´¢å¼•æ–°ç”Ÿæˆçš„æŠ¥å‘Šã€‚

### æŠ¥å‘Šåˆ—è¡¨

ä»¥è¡¨æ ¼å½¢å¼å±•ç¤ºæ‰€æœ‰æŠ¥å‘Šï¼š
- ç‚¹å‡»æ—¶é—´åˆ—çš„é“¾æ¥å¯ä»¥æ‰“å¼€å®Œæ•´æŠ¥å‘Šï¼ˆåœ¨æ–°æ ‡ç­¾é¡µï¼‰
- æˆåŠŸçš„æŠ¥å‘Šæ˜¾ç¤ºç»¿è‰²èƒŒæ™¯
- å¤±è´¥çš„æŠ¥å‘Šæ˜¾ç¤ºçº¢è‰²èƒŒæ™¯

## REST API

æœåŠ¡å™¨æä¾›å®Œæ•´çš„ REST APIï¼Œè®¿é—® http://localhost:8080/docs æŸ¥çœ‹äº¤äº’å¼æ–‡æ¡£ã€‚

### ä¸»è¦ç«¯ç‚¹

#### è·å–æŠ¥å‘Šåˆ—è¡¨
```
GET /api/reports?limit=50&offset=0&system_name=xxx&environment=dev&status=failed
```

#### è·å–å•ä¸ªæŠ¥å‘Šè¯¦æƒ…
```
GET /api/reports/{report_id}
```

#### è·å–ç»Ÿè®¡æ•°æ®
```
GET /api/stats
```

#### é‡æ–°æ‰«ææŠ¥å‘Šç›®å½•
```
POST /api/reports/rescan
```

#### æ›´æ–°æŠ¥å‘Šå¤‡æ³¨
```
PATCH /api/reports/{report_id}/notes?notes=xxx
```

#### åˆ é™¤æŠ¥å‘Šè®°å½•
```
DELETE /api/reports/{report_id}
```

## æ•°æ®åº“

æŠ¥å‘Šå…ƒæ•°æ®å­˜å‚¨åœ¨ SQLite æ•°æ®åº“ä¸­ï¼š`reports/reports.db`

æ•°æ®åº“åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
- åŸºæœ¬ä¿¡æ¯ï¼šfile_name, system_name, run_time
- ç»Ÿè®¡æ•°æ®ï¼štotal_cases, passed_cases, failed_cases, duration_ms ç­‰
- æ‰©å±•å­—æ®µï¼šenvironment, tags, notes, commit_sha

## æŠ€æœ¯æ ˆ

- **Web æ¡†æ¶**: FastAPIï¼ˆé«˜æ€§èƒ½ã€è‡ªåŠ¨æ–‡æ¡£ï¼‰
- **æ•°æ®åº“**: SQLiteï¼ˆé›¶é…ç½®ã€æ–‡ä»¶å‹ï¼‰
- **å‰ç«¯**: HTML + Alpine.jsï¼ˆè½»é‡çº§ã€3KBï¼‰
- **æœåŠ¡å™¨**: Uvicornï¼ˆASGI æœåŠ¡å™¨ï¼‰

## æ•…éšœæ’é™¤

### ç«¯å£è¢«å ç”¨

å¦‚æœ 8080 ç«¯å£è¢«å ç”¨ï¼Œä½¿ç”¨ `--port` æŒ‡å®šå…¶ä»–ç«¯å£ï¼š
```bash
drun serve --port 9000
```

### æŠ¥å‘Šç›®å½•ä¸å­˜åœ¨

æœåŠ¡å™¨ä¼šè‡ªåŠ¨åˆ›å»º `reports/` ç›®å½•ã€‚å¦‚æœéœ€è¦æŒ‡å®šå…¶ä»–ç›®å½•ï¼š
```bash
drun serve --reports-dir /path/to/reports
```

### ä¾èµ–ç¼ºå¤±

å¦‚æœæç¤ºç¼ºå°‘ FastAPI æˆ– uvicornï¼š
```bash
pip install fastapi uvicorn
```

æˆ–é‡æ–°å®‰è£… drunï¼š
```bash
pip install -e .
```

## å¼€å‘å»ºè®®

### å¼€å‘æ¨¡å¼

å¼€å‘æ—¶å»ºè®®ä½¿ç”¨çƒ­é‡è½½æ¨¡å¼ï¼Œä¿®æ”¹ä»£ç åè‡ªåŠ¨é‡å¯ï¼š
```bash
drun serve --reload
```

### å¤–éƒ¨è®¿é—®

å¦‚æœéœ€è¦è®©å›¢é˜Ÿå…¶ä»–æˆå‘˜è®¿é—®ï¼Œä½¿ç”¨ `--host 0.0.0.0`ï¼š
```bash
drun serve --host 0.0.0.0 --port 8080
```

**æ³¨æ„**ï¼šå¤–éƒ¨è®¿é—®éœ€è¦æ³¨æ„å®‰å…¨æ€§ï¼Œå»ºè®®ä»…åœ¨å—ä¿¡ä»»çš„ç½‘ç»œç¯å¢ƒä¸­ä½¿ç”¨ã€‚

### é›†æˆ CI/CD

å¯ä»¥åœ¨ CI/CD æµç¨‹ä¸­å¯åŠ¨ report serverï¼Œæ–¹ä¾¿æŸ¥çœ‹æµ‹è¯•ç»“æœï¼š
```yaml
# GitHub Actions ç¤ºä¾‹
- name: Start Report Server
  run: |
    drun serve --no-open --host 0.0.0.0 &
    echo "Report Server: http://localhost:8080"
```

## ç¤ºä¾‹å·¥ä½œæµ

1. **è¿è¡Œæµ‹è¯•ç”ŸæˆæŠ¥å‘Š**ï¼š
   ```bash
   drun run testcases --html reports/report-$(date +%Y%m%d-%H%M%S).html
   ```

2. **å¯åŠ¨ Report Server**ï¼š
   ```bash
   drun serve
   ```

3. **æµè§ˆå™¨è‡ªåŠ¨æ‰“å¼€**ï¼ŒæŸ¥çœ‹æ‰€æœ‰å†å²æŠ¥å‘Š

4. **ä½¿ç”¨ç­›é€‰å™¨**æŸ¥æ‰¾ç‰¹å®šæŠ¥å‘Š

5. **ç‚¹å‡»æŠ¥å‘Šé“¾æ¥**æŸ¥çœ‹è¯¦ç»†å†…å®¹

## æœªæ¥æ‰©å±•

å½“å‰ç‰ˆæœ¬å·²å®ç°æ ¸å¿ƒåŠŸèƒ½ï¼Œæœªæ¥å¯æ‰©å±•ï¼š
- ğŸ“Š è¶‹åŠ¿å›¾è¡¨ï¼ˆChart.jsï¼‰
- ğŸ” å…¨æ–‡æœç´¢ï¼ˆå¤±è´¥ç”¨ä¾‹åç§°ï¼‰
- ğŸ”„ å®æ—¶ç›‘æ§ï¼ˆWebSocket æ¨é€æ–°æŠ¥å‘Šï¼‰
- ğŸ“¥ æŠ¥å‘Šå¯¼å‡ºï¼ˆZIP æ‰“åŒ…ï¼‰
- ğŸ” è®¿é—®æ§åˆ¶ï¼ˆåŸºæœ¬è®¤è¯ï¼‰

## åé¦ˆä¸æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£æˆ–æäº¤ issueã€‚
