config:
  name: 商品目录
  base_url: ${ENV(BASE_URL)}
  tags: [catalog, smoke]

steps:
  - name: 获取分类列表
    request:
      method: GET
      url: /api/v1/categories/
      headers:
        Accept: application/json
    validate:
      - eq: [status_code, 200]
      - contains: [headers.Content-Type, application/json]
      - eq: [$.success, true]
      - eq: [$.code, 200]
      - eq: [$.message, 获取分类列表成功]
      - gt: ['$.data[0].id', 0]
      - contains: ['$.data[0]', name]

  - name: 获取商品列表
    request:
      method: GET
      url: /api/v1/products/
      headers:
        Accept: application/json
    extract:
      product_id: $.data.items[0].id
    validate:
      - eq: [status_code, 200]
      - contains: [headers.Content-Type, application/json]
      - eq: [$.success, true]
      - eq: [$.code, 200]
      - eq: [$.message, 获取产品列表成功]
      - gt: ['$.data.items[0].price', 0.0]
      - contains: ['$.data.items[0]', name]

  - name: 获取商品详情
    request:
      method: GET
      url: /api/v1/products/$product_id
      headers:
        Accept: application/json
    validate:
      - eq: [status_code, 200]
      - eq: [$.success, true]
      - eq: [$.code, 200]
      - eq: [$.message, 获取产品详情成功]
      - eq: [$.data.id, $product_id]
      - gt: [$.data.price, 0.0]
      - contains: [$.data, stock]
