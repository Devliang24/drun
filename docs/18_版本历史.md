# 版本历史

Drun 的版本更新记录。

## v7.0.0 (2025-11-27)

### 内置 Mock 数据生成

- **新增**: Faker 集成，支持 Mock 数据生成
  - 11 个新内置函数：`fake_name()`、`fake_email()`、`fake_address()` 等
  - 与现有函数一致的调用风格
  - YAML 中无需引号：`body: { name: ${fake_name()} }`
- **依赖**: 新增 `Faker>=24.0`

**新增函数列表**：
```yaml
${fake_name()}          # 随机姓名
${fake_email()}         # 随机邮箱
${fake_phone_number()}  # 随机电话
${fake_address()}       # 随机地址
${fake_city()}          # 随机城市
${fake_company()}       # 随机公司名
${fake_url()}           # 随机 URL
${fake_ipv4()}          # 随机 IPv4
${fake_user_agent()}    # 随机 UA
${fake_date()}          # 随机日期
${fake_text(100)}       # 随机文本
```

---

## v6.3.0 (2025-11-26)

### 测试用例质量评分

- **新增**: 测试用例评分系统
  - Step 级评分：断言(50%)、提取(30%)、重试(20%)
  - Case 级评分：参数化(50%)、Hooks(30%)、复用(20%)
  - 评分等级：A(90+绿)、B(70-89蓝)、C(50-69黄)、D(<50红)
  - CLI 命令：`drun score testcases/`
  - HTML 报告集成，显示平均分和改进建议

### v6.3.2/v6.3.3 (2025-11-26)

- **改进**: 报告列表页增加通知和结果列
- **改进**: 评分显示样式（灰色文本如 `A (95)`）
- **调整**: 默认每页从 15 条改为 18 条

---

## v6.2.0 (2025-11-26)

### 测试用例调用（invoke）

- **新增**: `invoke` 步骤类型，支持嵌套用例调用
  - 语法：`invoke: test_login` 或 `invoke: testcases/auth/test_login.yaml`
  - 智能路径解析（简写、后缀、目录）
  - `variables` 变量传递（位于 `invoke` 之前）
  - 提取变量自动导出到后续步骤
  - 支持嵌套调用（A → B → C）

**示例**：
```yaml
caseflow:
  - name: 登录获取 Token
    invoke: test_login

  - name: 创建订单
    variables:
      user_id: $userId
    invoke: test_create_order
```

---

## v6.0.0 (2024-11-25)

### Web 报告服务器

- **新增**: Web 报告服务器
  - 实时 HTML 报告查看：`http://0.0.0.0:8080`
  - 自动报告扫描和索引
  - SQLite 报告数据库
  - RESTful API：`/api/reports`
  - 命令：`drun s --port 8080 --no-open`
- **新增**: 报告列表和详情页，支持分页

---

## v5.0.0 (2024-11-24)

### 增强用户体验

- **新增**: 智能文件发现，运行测试时可省略 `.yaml`/`.yml` 后缀
- **改进**: 代码片段统一日志格式

---

## v4.2.0 (2024-11-24)

### 代码片段与 CSV 导出

- **新增**: Code Snippet - 自动生成 Shell 和 Python 脚本
- **新增**: CSV Export - 导出 API 响应数组到 CSV 文件

**代码片段**：
```bash
drun r test_api --env dev
# 自动生成 snippets/xxx/step1_xxx_curl.sh
# 自动生成 snippets/xxx/step1_xxx_python.py
```

**CSV 导出**：
```yaml
export:
  csv:
    data: $.data.users
    file: data/users.csv
```

---

## v4.0.0 (2024-11-20)

### Postman 式变量管理

- **新增**: 提取变量自动持久化到 `.env`
- **新增**: 套件内内存变量传递
- **新增**: 智能变量命名转换（camelCase → UPPER_CASE）

**自动持久化**：
```yaml
extract:
  token: $.data.token      # → TOKEN=xxx 保存到 .env
  userId: $.data.user.id   # → USER_ID=xxx 保存到 .env
```

---

## v3.0.0 (2024-11-15)

### 多格式导入导出

- **新增**: cURL 导入导出
- **新增**: Postman Collection 导入
- **新增**: HAR 文件导入
- **新增**: OpenAPI/Swagger 导入

---

## v2.0.0 (2024-11-10)

### 测试套件与标签

- **新增**: 测试套件（testsuite）支持
- **新增**: 标签过滤（-k 参数）
- **新增**: 布尔表达式：`smoke and not slow`

---

## v1.0.0 (2024-11-01)

### 初始版本

- YAML DSL 测试用例
- Dollar 模板语法
- HTTP 请求执行
- 12 种断言类型
- HTML/JSON 报告
- 环境变量管理
- CLI 命令行工具

---

## 版本对比

| 特性 | v1.0 | v4.0 | v6.0 | v7.0 |
|------|------|------|------|------|
| YAML DSL | ✓ | ✓ | ✓ | ✓ |
| 变量提取 | ✓ | ✓ | ✓ | ✓ |
| 自动持久化 | - | ✓ | ✓ | ✓ |
| 格式导入 | - | ✓ | ✓ | ✓ |
| 测试套件 | - | ✓ | ✓ | ✓ |
| invoke 调用 | - | - | ✓ | ✓ |
| 质量评分 | - | - | ✓ | ✓ |
| 报告服务器 | - | - | ✓ | ✓ |
| Faker 集成 | - | - | - | ✓ |

---

## 升级指南

### 从 v6.x 升级到 v7.x

```bash
pip install --upgrade drun
```

无破坏性变更，直接升级即可使用新的 `fake_*` 函数。

### 从 v5.x 升级到 v6.x

```bash
pip install --upgrade drun
```

新增 `invoke` 语法，旧用例无需修改。

### 从 v4.x 升级到 v5.x

```bash
pip install --upgrade drun
```

无破坏性变更。

---

## 更多信息

- **完整 Changelog**: [CHANGELOG.md](../CHANGELOG.md)
- **GitHub Releases**: https://github.com/Devliang24/drun/releases
